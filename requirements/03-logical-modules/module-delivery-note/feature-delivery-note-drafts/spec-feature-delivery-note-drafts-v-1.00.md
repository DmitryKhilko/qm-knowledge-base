**ID**: SPEC-FEATURE-DELIVERY-NOTE-DRAFTS  
**Версия:** 1.00  
**Статус:** Утверждено  
**Дата создания:** 01.02.2026  
**Автор:** Дмитрий Хилько  
**Программный продукт:** EDI-Flow  
**Модуль:** Накладные      
**Основная функциональность:** Управление черновиками  

# 1. БИЗНЕС-ТРЕБОВАНИЯ

## 1.1. БИЗНЕС-ПРОБЛЕМА  

1. **Потери данных и времени**. В текущем интерфейсе системы все данные накладной теряются при любом 
прерывании сеанса работы пользователя: переход в другой раздел системы, таймаут из-за простоя, вход с другого 
устройства. Это вынуждает сотрудников повторно выполнять уже сделанную работу, что снижает личную эффективность и 
создает риски ошибок при повторном вводе.
2. **Отсутствие возможности заполнять накладную несколькими пользователями**. Ключевые организации-клиенты системы 
используют распределение заполнения различных разделов накладной между разными специалистами или отделами. 
Текущая система не позволяет работать над одной накладной последовательно несколькими пользователями, что является 
нарушением внутренних регламентов организаций-клиентов - вынуждает одного специалиста заполнять накладную: вносить свою 
и несвойственную ему информацию, что увеличивает время обработки накладной и риск ошибок ввода.

## 1.2. БИЗНЕС-ЦЕЛИ

#### BG-DELIVERY-NOTE-DRAFTS-001
Исключить потери данных и времени пользователей при случайном прерывании сеанса создания накладной.

#### BG-DELIVERY-NOTE-DRAFTS-002
Обеспечить поддержку бизнес-процесса клиентов, когда над накладной работают несколько специалистов.

## 1.3. КРИТЕРИИ УСПЕХА  

- SUC-DELIVERY-NOTE-DRAFTS-001: Сокращение количества жалоб и инцидентов, связанных с потерей данных при создании накладных, на 90% 
по сравнению со среднемесячным количеством за квартал до внедрения. Источник: система поддержки. 
- SUC-DELIVERY-NOTE-DRAFTS-002: Не менее 90% создаваемых в системе накладных, подлежащих заполнению группой специалистов, проходят 
через публичные черновики в течение квартала после внедрения. Источник: аналитика системы. 
- SUC-DELIVERY-NOTE-DRAFTS-003: Удовлетворенность пользователей функциональностью управления черновиками ≥ 4.5 из 5. Источник: 
опрос пользователей.

# 2. БИЗНЕС-ПРАВИЛА (ОБЩИЕ)

### BR-DELIVERY-NOTE-DRAFTS-001
Ролевой доступ к функциям управления черновиками:
1. Имеют доступ пользователи с ролями: РАСХ, ПСХ.
2. Не имеют доступ пользователи с ролями: АИБ, АИС, ОТП, ГАСХ, АСХ, ЦБГО, АМНС, ОАМНС, РАМНС, АГТ, ПГТК.

### BR-DELIVERY-NOTE-DRAFTS-002
Приватный черновик можно создать для накладных следующих типов: ЭТН, ЭТТН, экспортной ЭТН, Электронного сообщения.  

# 3. СОЗДАНИЕ ПРИВАТНОГО ЧЕРНОВИКА

## 3.1. ПОЛЬЗОВАТЕЛЬСКИЕ ТРЕБОВАНИЯ (USE CASES)

### UC-DELIVERY-NOTE-DRAFTS-CREATE-001
**Название**: Сохранение по требованию пользователя, автосохранение приватного черновика  
**BG:** [BG-DELIVERY-NOTE-DRAFTS-004](#bg-drafts-004), [BG-DELIVERY-NOTE-DRAFTS-005](#bg-drafts-005)  
**Актор**: Пользователь с ролью [BR-DELIVERY-NOTE-DRAFTS-001](#br-delivery-note-drafts-001)  

**Основной поток**:
1. Пользователь создаёт новую накладную любого типа
2. Пользователь начинает заполнение формы накладной
3. Пользователь явно сохраняет промежуточное состояние как черновик
4. Система сохраняет данные как приватный черновик
5. Система подтверждает успешное сохранение
6. Пользователь продолжает заполнять форму приватного черновика
7. Пользователь явно сохраняет введенные в приватный черновик данные
8. Система подтверждает успешное сохранение

**Альтернативный поток A (Автосохранение)**:
1. После шага 2 основного потока, пользователь не выполняет явного сохранения
2. Система автоматически сохраняет изменения через заданный интервал времени
3. Система при первом автоматическом сохранении сохраняет данные как приватный черновик
4. Система информирует пользователя о состоянии автоматического сохранения
5. Пользователь наблюдает процесс автоматического сохранения

**Альтернативный поток B (Ошибка сохранения)**:
1. На шаге 4 основного потока возникает ошибка сохранения
2. Система уведомляет пользователя об ошибке
3. Пользователь повторяет попытку или продолжает работу без сохранения

**Альтернативный поток С (Ошибка автосохранения)**:
1. На шаге 2 альтернативного потока А возникает ошибка сохранения
2. Система уведомляет пользователя об ошибке
3. Пользователь дожидается очередной попытки автосохранения или вручную сохраняет черновик

## 3.2. ФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ

### FR-DELIVERY-NOTE-DRAFTS-CREATE-001
**Название:** Создание приватного черновика по требованию пользователя  
**BG:** [BG-DELIVERY-NOTE-DRAFTS-004](#bg-drafts-004)  
**UC:** [UC-DELIVERY-NOTE-DRAFTS-CREATE-001, основной поток](#uc-delivery-note-drafts-create-001)  
**Тип:** create, event-driven  

**Когда** пользователь с ролью ([BR-DELIVERY-NOTE-DRAFTS-001][1]) заполнил хотя бы одно поле в форме накладной с типом, 
разрешённым для создания черновиков ([BR-DELIVERY-NOTE-DRAFTS-002][2]), и нажал кнопку сохранения черновика,  
**система должна** сохранить данные как приватный черновик в течении времени ([NFR-PQ-PE-TB-001][3]),  
**чтобы** предотвратить потерю данных при непредвиденном закрытии формы накладной.  

**Критерии приемки:**
- Создается приватный черновик
- В таблице со списком приватных черновиков заполняются поля created_at и modified_at
- Пользователь остаётся на форме редактирования приватного черновика
- Отображается уведомление об успешном сохранении черновика

### FR-DELIVERY-NOTE-DRAFTS-CREATE-002
**Название:** Первое автоматическое сохранение приватного черновика  
**BG:** [BG-DELIVERY-NOTE-DRAFTS-005](#bg-drafts-005)    
**UC:** [UC-DELIVERY-NOTE-DRAFTS-CREATE-001, альтернативный поток А](#uc-delivery-note-drafts-create-001)  
**Тип:** create, ubiquitous  

**Пока** пользователь с ролью ([BR-DELIVERY-NOTE-DRAFTS-001][1]) редактирует приватный черновик,  
**система должна** автоматически сохранять изменения данных приватного черновика (скорость сохранения 
[NFR-PQ-PE-TB-DELIVERY-NOTE-DRAFTS-001][4]) через интервал, заданный параметром draft_save_interval,  
**чтобы** предотвратить потерю данных при непредвиденном закрытии формы черновика.

**Критерии приемки**:
- Сохранение данных приватного черновика происходит каждые N секунд (N = draft_save_interval)
- В таблице со списком приватных черновиков обновляется только поле modified_at
- На форме приватного черновика отображается индикатор состояния сохранения
- Процесс автосохранения не блокирует работу пользователя

## 3.3. НЕФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ

### NFR-PQ-PE-TB-DELIVERY-NOTE-DRAFTS-001
**Наименование:**: Среднее время автосохранения черновика накладной  
**BG:** [BG-DELIVERY-NOTE-DRAFTS-005](#bg-drafts-005)  
**UC:** [UC-DELIVERY-NOTE-DRAFTS-CREATE-001, альтернативный поток А](#uc-delivery-note-drafts-create-001)  
**FR:** [FR-DELIVERY-NOTE-DRAFTS-CREATE-002](#fr-delivery-note-drafts-create-002)  
**Атрибут качества:** Performance Efficiency  
**Податрибут:** Time behavior  
**Приоритет:** High  

**Описание:** Среднее время автосохранения черновика накладной при стандартной нагрузке должно быть не более 0,5 секунды без блокировки UI. 
Измеряется на базе 95% запросов, выполненных за период.  
**Шкала измерения:** Time  
**Единица измерения:** milliseconds  

**Уровни:**  
**Текущий:** Не измерялось  
**Минимально допустимый:** ≤ 1000 ms (для 95% запросов)  
**Целевой:** ≤ 500 ms (для 95% запросов)  
**Идеальный:** ≤ 300 ms (для 95% запросов)  

**Метод измерения:** Среднее время от получения HTTP-запроса до отправки ответа, включая обработку на сервере и запросы к базе данных.  
**Тестовый метод:** UI-тестирование для симуляции реальных запросов пользователей в условиях нормальной и повышенной нагрузки.  

## 3.4. ТЕСТ-КЕЙСЫ
### 3.4.1. ФУНКЦИОНАЛЬНЫЕ ТРЕБОВАНИЯ

#### TC-DELIVERY-NOTE-DRAFTS-CREATE-001
**Наименование:** Создание приватного черновика по требованию пользователя     
**FR:** [FR-DELIVERY-NOTE-DRAFTS-CREATE-001](#fr-delivery-note-drafts-create-001)  
**Приоритет:** Высокий  

**Предусловия:**
- Пользователь авторизован с разрешенной для создания черновика ролью.
- Открыта форма создания новой накладной, допускающей создание черновика.

**Шаги выполнения**:
1. Заполнить любое обязательное или необязательное поле формы накладной.
2. Нажать кнопку "Сохранить черновик".

**Ожидаемый результат:**
- Система сохраняет данные. Время сохранения соответствует требованию.
- В БД создается запись черновика. Заполнены поля created_at и modified_at.
- Пользователь остается на той же форме редактирования.
- Появляется уведомление "Черновик успешно сохранен".


[1]: <#br-delivery-note-drafts-001>
[2]: <#br-delivery-note-drafts-002>
[3]: <../../../02-architecture/05-global-quality-attributes/NFR-PQ-PE-TB-001-Среднее время-отклика-v-1.0.md#>
[4]: <#nfr-pq-pe-tb-drafts-001>


["Я отказался от идеи такого обозначения детальных функциональностей в пользу полных русских названий **Детальная функциональность:** CREATE, READ, ACCESS CONTROL, SORT-FILTER, CREATE, UPDATE, DELETE, STATES-TRANSITIONS]: # 